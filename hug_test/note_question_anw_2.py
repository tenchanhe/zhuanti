from transformers import AutoModelForTableQuestionAnswering, AutoTokenizer, pipeline
import pandas as pd
model = 'google/tapas-large-finetuned-wtq'
tapas_model = AutoModelForTableQuestionAnswering.from_pretrained(model)
tapas_tokenizer = AutoTokenizer.from_pretrained(model)

# Initializing pipeline
nlp = pipeline('table-question-answering', model=tapas_model, tokenizer=tapas_tokenizer)


def qa(query,data):
    print('>>>>>')
    print(query)
    result = nlp({'table': data,'query':query})
    answer = result['cells']
    print(answer)


def read_data():
    data = {}

    with open('data_tbqa.txt', 'r') as file:
        for line in file:
            # 切分每一行的名稱和數值部分
            parts = line.strip().split(':')
            if len(parts) == 2:
                # 去掉引號和括號，並將名稱和數值部分分開
                name = parts[0].strip(' "')
                values = parts[1].strip(' []\n').split(',')
                # print(values)
                # print(values)
                # 將名稱和數值部分添加到字典中
                data[name] = values

    return data


if __name__ == "__main__":
    data = read_data()
    # data={
        # "course_name":['management','management','management','management','management','management','management','management','management','management','management','management','management','management','management','management','management','management','statistics','statistics','statistics','statistics','statistics','statistics','statistics','statistics','statistics','statistics（一）',],
    # "teacher_name":['彭朱如','蔡維奇、羅明琇','成力庚、黃家齊','傅浚映','黃韋仁','郭曉玲','吳恬妤、黃家齊','張彥成','謝凱宇','翁玲華','胡昌亞','李瓊淑','曹莉玲','廖經維','胡昌亞、范思美、陳燕諭','林呈欣','林介勝','胡昌亞、范思美','陳麗霞','翁久幸','薛慧敏','楊素芬','劉惠美','周珮婷','陳心蘋','鄭宇庭','黃佳慧','陳麗霞',],
    # "difficult":['0.8182195425033569','0.6674016714096069','0.3333272337913513','0.9299289584159852','0.913782000541687','0.8443783521652222','0.8925241827964783','0.9364222288131714','0.52931147813797','0.8811437487602234','0.7341459393501282','0.9752620458602904','0.5069355964660645','0.745098888874054','0.6783252954483032','0.6532494425773621','0.8181560635566711','0.8549715280532837','0.6704201102256775','0.7829322218894958','0.9675440192222596','0.4677819907665252','0.8762893676757812','0.9111193418502808','0.7048956751823425','0.7657737135887146','0.9491931796073914','0.7272729873657227',],
    # "busy":['0.8024741411209106','0.5514957308769226','0.1276640444993972','0.9551252126693726','0.962145984172821','0.9180355072021484','0.9767853617668152','0.9735721945762634','0.5455163717269897','0.9219474792480468','0.6329165101051331','0.9871159195899964','0.4055183529853821','0.8402018547058105','0.2668387293815613','0.6812968850135803','0.935681164264679','0.8130151033401489','0.815517008304596','0.7419243454933167','0.9707733392715454','0.5393327474594116','0.8351333141326904','0.8991386294364929','0.7982923984527588','0.9358848929405212','0.9407919049263','0.7814188599586487',],
    # "low":['0.9665459394454956','0.6267873048782349','0.5527256727218628','0.827985405921936','0.8523410558700562','0.5837082862854004','0.736656665802002','0.8222642540931702','0.2694483399391174','0.6275872588157654','0.1288109868764877','0.952942669391632','0.2892338931560516','0.572537362575531','0.2642002999782562','0.4599970579147339','0.7913257479667664','0.545236349105835','0.5854703783988953','0.6338620781898499','0.9340961575508118','0.3866700232028961','0.6998040080070496','0.6995199918746948','0.8175971508026123','0.6224830746650696','0.8921923041343689','0.7619252800941467',],
    # "high":['0.482124924659729','0.5002021789550781','0.1042820140719413','0.9572854042053224','0.97504985332489','0.8847326040267944','0.9523383975028992','0.9857455492019652','0.6457886695861816','0.9188355207443236','0.822962760925293','0.9933499693870544','0.701541543006897','0.5815527439117432','0.8770330548286438','0.7774893045425415','0.4039492905139923','0.8211548924446106','0.7984605431556702','0.5487373471260071','0.973985493183136','0.3179448544979095','0.90730220079422','0.7256879210472107','0.8216436505317688','0.7990782260894775','0.9703506231307985','0.7026942372322083',],
    # "easy":['0.0672395527362823','0.3651922047138214','0.0070264772512018','0.9292572140693665','0.7526476383209229','0.625724196434021','0.9011847376823424','0.9498264193534852','0.2009154260158538','0.7699266672134399','0.2319972813129425','0.9769645929336548','0.1511406153440475','0.5404032468795776','0.0326444618403911','0.1479864418506622','0.3873880505561828','0.1098375767469406','0.5700886845588684','0.4710175395011902','0.8903406858444214','0.2456371188163757','0.4507563412189483','0.6308205127716064','0.8099625706672668','0.4097693562507629','0.9295555353164672','0.754332959651947',],
    # "interesting":['0.9903184175491332','0.981223464012146','0.52016681432724','0.9874096512794496','0.9839252233505248','0.9565125107765198','0.9821392297744752','0.9915090203285216','0.7232750058174133','0.9335325360298156','0.9969027042388916','0.9947583079338074','0.9908666610717772','0.8607321381568909','0.9884963631629944','0.9869756102561952','0.9401026368141174','0.9426320791244508','0.824151337146759','0.7911768555641174','0.9848327040672302','0.6096611618995667','0.8791745901107788','0.9484599232673644','0.9138683080673218','0.970385193824768','0.9873576760292052','0.92434561252594',],
    # "clear":['0.5473873019218445','0.5911794900894165','0.1804862320423126','0.9907385110855104','0.98188453912735','0.9486432075500488','0.9853790402412416','0.9827065467834472','0.6707909107208252','0.9516799449920654','0.99438738822937','0.9944059252738952','0.8863174319267273','0.6994434595108032','0.3871765732765198','0.597894012928009','0.7494900226593018','0.9424507021903992','0.8918862342834473','0.7832290530204773','0.9821420311927797','0.4827458560466766','0.8916055560112','0.9409528970718384','0.9050703048706056','0.9275075793266296','0.9889978170394896','0.9000734090805054',],
    # "implicit":['0.6525604128837585','0.7784960269927979','0.0923106893897056','0.9551089406013488','0.9722049832344056','0.9235035181045532','0.9417707920074464','0.9792248606681824','0.6241302490234375','0.9506616592407228','0.7410716414451599','0.9863289594650269','0.5244704484939575','0.827953577041626','0.5588725805282593','0.7049762010574341','0.8576213121414185','0.702308714389801','0.8272027373313904','0.8687910437583923','0.9713171124458312','0.6736491322517395','0.8980808258056641','0.9570729732513428','0.9086862206459044','0.8756190538406372','0.9313840866088868','0.9046553373336792',],
    # "heavy":['0.6426762938499451','0.2342578470706939','0.0243015848100185','0.9554015398025512','0.926597535610199','0.8451985716819763','0.9457038640975952','0.978213667869568','0.4932425916194916','0.8612047433853149','0.4210889935493469','0.989604651927948','0.274267166852951','0.6440996527671814','0.1957361102104187','0.1224479973316192','0.8022432923316956','0.4243305325508117','0.7857922911643982','0.7039027214050293','0.9627943634986876','0.3527872562408447','0.8657395839691162','0.8976791501045227','0.7662086486816406','0.7745144367218018','0.9452583193778992','0.598577082157135',],
    # "boring":['0.0547147579491138','0.0360186137259006','0.1139731481671333','0.6399707794189453','0.6549503803253174','0.4175378084182739','0.6667240858078003','0.852242112159729','0.0894062146544456','0.783369243144989','0.0071602626703679','0.9112622141838074','0.0437767915427684','0.311459332704544','0.0012067810166627','0.0069695636630058','0.2986179292201996','0.0047380193136632','0.2904593348503113','0.5332149863243103','0.8115575313568115','0.1044727861881256','0.3489878177642822','0.4252049624919891','0.5641995668411255','0.2012079954147339','0.5529916882514954','0.3032577335834503',],
    # "thoughtful":['0.962038278579712','0.904721975326538','0.6083024144172668','0.9879163503646852','0.9839964509010316','0.9629449844360352','0.9903594851493835','0.9898366928100586','0.7861592769622803','0.95767080783844','0.978513479232788','0.9944120049476624','0.9956875443458556','0.8504574298858643','0.9682583808898926','0.954800546169281','0.8905423283576965','0.9794318675994872','0.9103838801383972','0.9099688529968262','0.9863109588623048','0.7178907990455627','0.9270007610321044','0.9537341594696044','0.9213021397590636','0.982025980949402','0.9898499846458436','0.9488485455513',],
    # "sweet":['0.8865259885787964','0.7870907783508301','0.7899476289749146','0.985966682434082','0.9757654070854188','0.914250373840332','0.9546411037445068','0.9881240725517272','0.4797501564025879','0.9343036413192748','0.9818061590194702','0.9938768744468688','0.9524383544921876','0.7497192025184631','0.8709351420402527','0.89239501953125','0.8998939990997314','0.9941754937171936','0.7131221294403076','0.7389116287231445','0.9660298824310304','0.3963488042354584','0.7945224642753601','0.9258602857589722','0.8752028346061707','0.9229881763458252','0.9862967133522034','0.8042349219322205',],
    # "hard":['0.6765177249908447','0.585900068283081','0.3443607687950134','0.9669559001922609','0.8967925310134888','0.8586413860321045','0.9329888224601746','0.9669472575187684','0.4984385371208191','0.9068599939346312','0.5911455750465393','0.974579930305481','0.4421788156032562','0.707518994808197','0.4446803629398346','0.5253283381462097','0.7713326215744019','0.7936821579933167','0.7017878890037537','0.7492763996124268','0.966561794281006','0.3680013418197632','0.8088478446006775','0.925303280353546','0.6872724294662476','0.7725265026092529','0.9346495866775512','0.7054210305213928',],
    # "cold":['0.7488244771957397','0.1118908673524856','0.1484593898057937','0.8958470821380615','0.8826515078544617','0.6401506066322327','0.7859447002410889','0.9018462896347046','0.2665105164051056','0.8509117960929871','0.0442557856440544','0.9659549593925476','0.0253407340496778','0.5700528621673584','0.0050582052208483','0.0931118726730346','0.9898832440376282','0.1599714159965515','0.7466432452201843','0.7315890192985535','0.9568316340446472','0.3993106782436371','0.7630831003189087','0.8699723482131958','0.7479502558708191','0.7564706802368164','0.8304190039634705','0.6262716054916382',]
            # }

    qa('Which teachers statistics most busy?',data)
    qa('Which teachers course most interesting?',data)
    qa('Which  course most busy?',data)
    qa('Which teachers course most cold?',data)
    # # qa('Please give me three of the easiest course',data)
    # qa('Which teachers course most not busy?',data)
